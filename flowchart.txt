+---------------------------+
|          Start            |
+---------------------------+

           ↓

+---------------------------+
|    Initialize Sensors     |
| ------------------------- |
| • Init Serial (debug)     |
| • Init BNO055 IMU         |
| • Init GPS serial comms   |
| • Load IMU calibration    |
+---------------------------+

           ↓

+---------------------------+
|     Main Loop (every dt)  |
+---------------------------+

           ↓

+---------------------------+
|    Read GPS Data Serial   |
| ------------------------- |
| • Read GPS bytes          |
| • Parse with TinyGPSPlus  |
+---------------------------+

           ↓

+------------------------------------+
|  Is New GPS Location Available?    |
+-----------------+------------------+
          Yes                      No
           ↓                        ↓
+---------------------------+  +-------------------------+
| Read Lat, Lon, Speed      |  | Check GPS Timeout       |
| If origin not set → set   |  | If timeout → GPS Avail = FALSE |
| Update last GPS fix time  |  +-------------------------+
| Set GPS Available = TRUE  |
+---------------------------+

           ↓

+---------------------------+
| Read IMU Acceleration &    |
| Orientation                |
| ------------------------- |
| • Get linear acceleration |
| • Get orientation quat    |
+---------------------------+

           ↓

+---------------------------+
| Calculate Acceleration     |
| Magnitude                 |
+---------------------------+

           ↓

+-------------------------------------+
| Determine Movement Status            |
| ----------------------------------- |
| Accel mag > threshold OR GPS speed > threshold? |
|           /      \                   |
|         Yes       No                 |
|         ↓         ↓                  |
|       Moving   Stationary            |
+-------------------------------------+

           ↓

+-------------------------------------+
| Rotate Acceleration Vector to Earth |
| ----------------------------------- |
| • Use quaternion math               |
| • Extract earth-frame X, Y accel    |
+-------------------------------------+

           ↓

+---------------------------+
| Kalman Filter Predict Step |
| ------------------------- |
| IF Moving:                 |
|   • Predict position & vel |
|   • Update covariance      |
| ELSE Stationary:           |
|   • Update pos with vel    |
|   • Apply velocity damping |
+---------------------------+

           ↓

+---------------------------+
| Kalman Filter Update Step  |
| ------------------------- |
| IF GPS available & Moving: |
|   • Convert GPS lat/lon → XY |
|   • Calculate residual     |
|   • Calculate Kalman gain  |
|   • Update state estimate  |
|   • Update covariance      |
+---------------------------+

           ↓

+---------------------------+
| Convert Filtered Position  |
| Back to GPS Coordinates    |
+---------------------------+

           ↓

+---------------------------+
| Print / Output Position    |
+---------------------------+

           ↓

+---------------------------+
| Delay dt seconds           |
+---------------------------+

           ↓

+---------------------------+
| Repeat Main Loop          |
+---------------------------+
